
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>metadata &#8212; skdiveMove 0.1.7 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skdiveMove 0.1.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">metadata</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for metadata</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Tools to read and write DataArray and Dataset attributes</span>

<span class="sd">Easily dump a template to set up metadata for a given Dataset or DataArray</span>
<span class="sd">that can subsequenty be read-in and append attributes to the objects.</span>


<span class="sd">Functions</span>
<span class="sd">---------</span>

<span class="sd">.. autosummary::</span>

<span class="sd">   dump_template</span>
<span class="sd">   assign_xr_attrs</span>


<span class="sd">API</span>
<span class="sd">---</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dump_template&quot;</span><span class="p">,</span> <span class="s2">&quot;assign_xr_attrs&quot;</span><span class="p">]</span>

<span class="n">_SENSOR_DATA_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;sampling&#39;</span><span class="p">:</span> <span class="s2">&quot;regular&quot;</span><span class="p">,</span>
    <span class="s1">&#39;sampling_rate&#39;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="s1">&#39;sampling_rate_unit&#39;</span><span class="p">:</span> <span class="s2">&quot;Hz&quot;</span><span class="p">,</span>
    <span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;units_name&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;units_label&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;column_name&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;frame&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;axes&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
<span class="p">}</span>

<span class="n">_DATASET_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dep_id&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;dep_device_tzone&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;dep_device_regional_settings&#39;</span><span class="p">:</span> <span class="s2">&quot;YYYY-mm-dd HH:MM:SS&quot;</span><span class="p">,</span>
    <span class="s1">&#39;dep_device_time_beg&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;deploy&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;locality&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;device_time_on&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">},</span>
    <span class="s1">&#39;project&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;date_beg&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;date_end&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">},</span>
    <span class="s1">&#39;provider&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;affiliation&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;license&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;cite&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;doi&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">},</span>
    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;creation_date&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;nfiles&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">},</span>
    <span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;make&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">},</span>
    <span class="s1">&#39;sensors&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;firmware&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;software&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">},</span>
    <span class="s1">&#39;animal&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;species_common&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;species_science&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;dbase_url&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>


<div class="viewcode-block" id="dump_template"><a class="viewcode-back" href="../metadata.html#metadata.dump_template">[docs]</a><span class="k">def</span> <span class="nf">dump_template</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">config_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump configuration file</span>

<span class="sd">    Dump a json configuration template file to buil metadata for a Dataset</span>
<span class="sd">    or DataArray.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str</span>
<span class="sd">        A valid string path for output file.</span>
<span class="sd">    config_type : {&quot;dataset&quot;, &quot;sensor&quot;}</span>
<span class="sd">        The type of config to dump.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import skdiveMove.metadata as skmeta</span>
<span class="sd">    &gt;&gt;&gt; skmeta.dump_template(&quot;mydataset.json&quot;, &quot;dataset&quot;)</span>
<span class="sd">    &gt;&gt;&gt; skmeta.dump_template(&quot;mysensor.json&quot;, &quot;sensor&quot;)</span>

<span class="sd">    edit the files to your specifications.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">config_type</span> <span class="o">==</span> <span class="s2">&quot;dataset&quot;</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">_DATASET_CONFIG</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">config_type</span> <span class="o">==</span> <span class="s2">&quot;sensor&quot;</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">_SENSOR_DATA_CONFIG</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="assign_xr_attrs"><a class="viewcode-back" href="../metadata.html#metadata.assign_xr_attrs">[docs]</a><span class="k">def</span> <span class="nf">assign_xr_attrs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">config_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assign attributes to xarray.Dataset or xarray.DataArray</span>

<span class="sd">    The `config_file` should have only one-level of nesting.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : {xarray.Dataset, xarray.DataArray}</span>
<span class="sd">        Object to assign attributes to.</span>
<span class="sd">    config_file : str</span>
<span class="sd">        A valid string path for input json file with metadata attributes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : {xarray.Dataset, xarray.DataArray}</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import xarray as xr</span>
<span class="sd">    &gt;&gt;&gt; import skdiveMove.metadata as skmeta</span>

<span class="sd">    Synthetic dataset with depth and speed</span>

<span class="sd">    &gt;&gt;&gt; nsamples = 60 * 60 * 24</span>
<span class="sd">    &gt;&gt;&gt; times = pd.date_range(&quot;2000-01-01&quot;, freq=&quot;1s&quot;, periods=nsamples,</span>
<span class="sd">    ...                       name=&quot;time&quot;)</span>
<span class="sd">    &gt;&gt;&gt; cycles = np.sin(2 * np.pi * np.arange(nsamples) / (60 * 20))</span>
<span class="sd">    &gt;&gt;&gt; ds = xr.Dataset({&quot;depth&quot;: ((&quot;time&quot;), 1 + cycles),</span>
<span class="sd">    ...                  &quot;speed&quot;: ((&quot;time&quot;), 3 + cycles)},</span>
<span class="sd">    ...                 {&quot;time&quot;: times})</span>

<span class="sd">    Dump dataset and sensor templates</span>

<span class="sd">    &gt;&gt;&gt; skmeta.dump_template(&quot;mydataset.json&quot;, &quot;dataset&quot;)</span>
<span class="sd">    &gt;&gt;&gt; skmeta.dump_template(&quot;P_sensor.json&quot;, &quot;sensor&quot;)</span>
<span class="sd">    &gt;&gt;&gt; skmeta.dump_template(&quot;S_sensor.json&quot;, &quot;sensor&quot;)</span>

<span class="sd">    Edit the templates as appropriate, load and assign to objects</span>

<span class="sd">    &gt;&gt;&gt; assign_xr_attrs(ds, &quot;mydataset.json&quot;)</span>
<span class="sd">    &gt;&gt;&gt; assign_xr_attrs(ds.depth, &quot;P_sensor.json&quot;)</span>
<span class="sd">    &gt;&gt;&gt; assign_xr_attrs(ds.speed, &quot;S_sensor.json&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">ifile</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ifile</span><span class="p">)</span>

    <span class="c1"># Parse the dict</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">top_kname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key_n</span><span class="p">,</span> <span class="n">val_n</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">val_n</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">lower_kname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">top_kname</span><span class="p">,</span> <span class="n">key_n</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">lower_kname</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">top_kname</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/skdiveMove_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skdiveMove 0.1.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">metadata</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Sebastian Luque.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
<div class="footer">
  scikit-diveMove icon created by B. Agustín Amenábar Larraín
  from Noun Project
</div>

  </body>
</html>