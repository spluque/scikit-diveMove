
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bout analysis &#8212; skdiveMove 0.1.9 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/thebelab.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Simulating bouts" href="boutsimuldemo.html" />
    <link rel="prev" title="Diving behaviour analysis" href="tdrdemo.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="boutsimuldemo.html" title="Simulating bouts"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tdrdemo.html" title="Diving behaviour analysis"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">skdiveMove 0.1.9 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Bout analysis</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="bout-analysis">
<span id="boutsdemo-label"></span><h1>Bout analysis<a class="headerlink" href="#bout-analysis" title="Permalink to this headline">¶</a></h1>
<p>Here is a brief demo on bout analysis with <cite>skdiveMove.bouts</cite> for data
generated by mixtures of random Poisson processes.</p>
<p>Set up the environment.  Consider loading the <cite>logging</cite> module and setting
up a logger to monitor progress to this section.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Set up</span>
<span class="kn">import</span> <span class="nn">pkg_resources</span> <span class="k">as</span> <span class="nn">pkg_rsrc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">skdiveMove</span> <span class="kn">import</span> <span class="n">calibrate</span>
<span class="kn">import</span> <span class="nn">skdiveMove.bouts</span> <span class="k">as</span> <span class="nn">skbouts</span>

<span class="c1"># Declare figure sizes</span>
<span class="n">_FIG1X1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">_FIG1X2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">_FIG3X1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="jupyter_cell docutils container">
<div class="cell_output docutils container">
</div>
</div>
<div class="section" id="calculate-postdive-duration">
<h2>Calculate postdive duration<a class="headerlink" href="#calculate-postdive-duration" title="Permalink to this headline">¶</a></h2>
<p>Create a <code class="xref py py-class docutils literal notranslate"><span class="pre">TDR</span></code> object to easily calculate the necessary statistics:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">config_file</span> <span class="o">=</span> <span class="p">(</span><span class="n">pkg_rsrc</span>
               <span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s2">&quot;skdiveMove&quot;</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s2">&quot;config_examples/&quot;</span>
                                   <span class="s2">&quot;ag_mk7_2002_022_config.json&quot;</span><span class="p">)))</span>
<span class="n">tdr_file</span> <span class="o">=</span> <span class="p">(</span><span class="n">pkg_rsrc</span>
            <span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s2">&quot;skdiveMove&quot;</span><span class="p">,</span>
                               <span class="p">(</span><span class="s2">&quot;tests/data/&quot;</span>
                                <span class="s2">&quot;ag_mk7_2002_022.nc&quot;</span><span class="p">)))</span>
<span class="n">tdrX</span> <span class="o">=</span> <span class="n">calibrate</span><span class="p">(</span><span class="n">tdr_file</span><span class="p">,</span> <span class="n">config_file</span><span class="p">)</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">tdrX</span><span class="o">.</span><span class="n">dive_stats</span><span class="p">()</span>
<span class="n">stamps</span> <span class="o">=</span> <span class="n">tdrX</span><span class="o">.</span><span class="n">stamp_dives</span><span class="p">(</span><span class="n">ignore_z</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">stats_tab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">stamps</span><span class="p">,</span> <span class="n">stats</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">stats_tab</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 426 entries, 1 to 426
Data columns (total 49 columns):
 #   Column               Non-Null Count  Dtype          
---  ------               --------------  -----          
 0   phase_id             426 non-null    int64          
 1   beg                  426 non-null    datetime64[ns] 
 2   end                  426 non-null    datetime64[ns] 
 3   begdesc              426 non-null    datetime64[ns] 
 4   enddesc              426 non-null    datetime64[ns] 
 5   begasc               426 non-null    datetime64[ns] 
 6   desctim              426 non-null    float64        
 7   botttim              292 non-null    float64        
 8   asctim               426 non-null    float64        
 9   divetim              426 non-null    float64        
 10  descdist             426 non-null    float64        
 11  bottdist             292 non-null    float64        
 12  ascdist              426 non-null    float64        
 13  bottdep_mean         292 non-null    float64        
 14  bottdep_median       292 non-null    float64        
 15  bottdep_sd           292 non-null    float64        
 16  maxdep               426 non-null    float64        
 17  desc_tdist           202 non-null    float64        
 18  desc_mean_speed      202 non-null    float64        
 19  desc_angle           169 non-null    float64        
 20  bott_tdist           292 non-null    float64        
 21  bott_mean_speed      292 non-null    float64        
 22  asc_tdist            157 non-null    float64        
 23  asc_mean_speed       157 non-null    float64        
 24  asc_angle            151 non-null    float64        
 25  descD_mean           426 non-null    float64        
 26  descD_std            426 non-null    float64        
 27  descD_min            426 non-null    float64        
 28  descD_25%            426 non-null    float64        
 29  descD_50%            426 non-null    float64        
 30  descD_75%            426 non-null    float64        
 31  descD_max            426 non-null    float64        
 32  bottD_mean           292 non-null    float64        
 33  bottD_std            292 non-null    float64        
 34  bottD_min            292 non-null    float64        
 35  bottD_25%            292 non-null    float64        
 36  bottD_50%            292 non-null    float64        
 37  bottD_75%            292 non-null    float64        
 38  bottD_max            292 non-null    float64        
 39  ascD_mean            426 non-null    float64        
 40  ascD_std             425 non-null    float64        
 41  ascD_min             426 non-null    float64        
 42  ascD_25%             426 non-null    float64        
 43  ascD_50%             426 non-null    float64        
 44  ascD_75%             426 non-null    float64        
 45  ascD_max             426 non-null    float64        
 46  postdive_dur         426 non-null    timedelta64[ns]
 47  postdive_tdist       420 non-null    float64        
 48  postdive_mean_speed  420 non-null    float64        
dtypes: datetime64[ns](5), float64(42), int64(1), timedelta64[ns](1)
memory usage: 166.4 KB
</pre></div>
</div>
</div>
</div>
<p>Extract postdive duration for further analysis.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">postdives</span> <span class="o">=</span> <span class="n">stats_tab</span><span class="p">[</span><span class="s2">&quot;postdive_dur&quot;</span><span class="p">][</span><span class="n">stats_tab</span><span class="p">[</span><span class="s2">&quot;phase_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">postdives_diff</span> <span class="o">=</span> <span class="n">postdives</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<span class="c1"># Remove isolated dives</span>
<span class="n">postdives_diff</span> <span class="o">=</span> <span class="n">postdives_diff</span><span class="p">[</span><span class="n">postdives_diff</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</div>
<div class="section" id="non-linear-least-squares-via-broken-stick-model">
<h2>Non-linear least squares via “broken-stick” model<a class="headerlink" href="#non-linear-least-squares-via-broken-stick-model" title="Permalink to this headline">¶</a></h2>
<p><cite>skdiveMove</cite> provides the <code class="xref py py-class docutils literal notranslate"><span class="pre">BoutsNLS</span></code> class for fitting non-linear
least squares (NLS) models to a modified histogram of a given variable.</p>
<p>The first step is to generate a modified histogram of postdive duration,
and this requires choosing the bin width for the histogram.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">postdives_nlsbouts</span> <span class="o">=</span> <span class="n">skbouts</span><span class="o">.</span><span class="n">BoutsNLS</span><span class="p">(</span><span class="n">postdives_diff</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">postdives_nlsbouts</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Class BoutsNLS object
histogram method:    standard
log-frequency histogram:
             x  lnfreq
count    50.00  50.000
mean    284.54  -3.684
std     376.22   2.632
min       0.05  -8.216
25%      42.55  -5.521
50%     122.55  -3.912
75%     328.80  -2.798
max    1449.95   3.258
</pre></div>
</div>
</div>
</div>
<div class="section" id="two-process-model">
<h3>Two-process model<a class="headerlink" href="#two-process-model" title="Permalink to this headline">¶</a></h3>
<p>Assuming a 2-process model, calculate starting values, providing a guess at
50 s interdive interval.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">_FIG1X1</span><span class="p">)</span>
<span class="n">init_pars2</span> <span class="o">=</span> <span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">init_pars</span><span class="p">([</span><span class="mi">50</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<img alt="_images/boutsdemo_5_0.png" src="_images/boutsdemo_5_0.png" />
</div>
</div>
<p>Fit the two-process model.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">coefs2</span><span class="p">,</span> <span class="n">pcov2</span> <span class="o">=</span> <span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">init_pars2</span><span class="p">)</span>
<span class="c1"># Coefficients</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coefs2</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>        (0.049, 50.0]  (50.0, 1449.95]
a              41.686            8.108
lambda          0.115            0.003
</pre></div>
</div>
</div>
</div>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Covariance between parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pcov2</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>[[+4.375e+02 +4.039e-01 +1.464e+00 +3.388e-04]
 [+4.039e-01 +1.110e-03 +1.139e-02 +2.793e-06]
 [+1.464e+00 +1.139e-02 +3.759e+00 +1.511e-04]
 [+3.388e-04 +2.793e-06 +1.511e-04 +3.574e-07]]
</pre></div>
</div>
</div>
</div>
<p>Calculate bout-ending criterion.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># `bec` returns ndarray, and we have only one here</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bec = {[0]:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">bec</span><span class="p">(</span><span class="n">coefs2</span><span class="p">)))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>bec = 47.50
</pre></div>
</div>
</div>
</div>
<p>Plot the fit.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">_FIG1X1</span><span class="p">)</span>
<span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">(</span><span class="n">coefs2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<img alt="_images/boutsdemo_9_0.png" src="_images/boutsdemo_9_0.png" />
</div>
</div>
</div>
<div class="section" id="three-process-model">
<h3>Three-process model<a class="headerlink" href="#three-process-model" title="Permalink to this headline">¶</a></h3>
<p>Attempt to discern three processes in the data.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">_FIG1X1</span><span class="p">)</span>
<span class="n">init_pars3</span> <span class="o">=</span> <span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">init_pars</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mi">550</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<img alt="_images/boutsdemo_10_0.png" src="_images/boutsdemo_10_0.png" />
</div>
</div>
<p>Fit three-process model.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">coefs3</span><span class="p">,</span> <span class="n">pcov3</span> <span class="o">=</span> <span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">init_pars3</span><span class="p">)</span>
<span class="c1"># Coefficients</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coefs3</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>        (0.049, 50.0]  (50.0, 550.0]  (550.0, 1449.95]
a              43.033          5.836             3.732
lambda          0.136          0.011             0.001
</pre></div>
</div>
</div>
</div>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Covariance between parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pcov3</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>[[+5.457e+02 +5.911e-01 +1.012e+00 -5.469e-05 -8.834e-02 -1.191e-04]
 [+5.911e-01 +2.317e-03 +2.922e-02 +1.217e-04 +9.120e-03 +1.012e-05]
 [+1.012e+00 +2.922e-02 +6.778e+00 +4.515e-04 -8.611e-01 -1.570e-03]
 [-5.469e-05 +1.217e-04 +4.515e-04 +6.806e-05 +6.797e-03 +8.297e-06]
 [-8.834e-02 +9.120e-03 -8.611e-01 +6.797e-03 +2.934e+00 +6.962e-04]
 [-1.191e-04 +1.012e-05 -1.570e-03 +8.297e-06 +6.962e-04 +2.382e-06]]
</pre></div>
</div>
</div>
</div>
<p>Plot the fit.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">_FIG1X1</span><span class="p">)</span>
<span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">(</span><span class="n">coefs3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<img alt="_images/boutsdemo_13_0.png" src="_images/boutsdemo_13_0.png" />
</div>
</div>
<p>Compare the cumulative frequency distributions of two- vs three-process
models.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">_FIG1X2</span><span class="p">)</span>
<span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">plot_ecdf</span><span class="p">(</span><span class="n">coefs2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">plot_ecdf</span><span class="p">(</span><span class="n">coefs3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<img alt="_images/boutsdemo_14_0.png" src="_images/boutsdemo_14_0.png" />
</div>
</div>
<p>The three-process model does not seem appropriate.</p>
</div>
</div>
<div class="section" id="maximum-likelihood-estimation">
<h2>Maximum likelihood estimation<a class="headerlink" href="#maximum-likelihood-estimation" title="Permalink to this headline">¶</a></h2>
<p>Another way to model Poisson mixtures that does not rely on the
subjectively created histogram, and involves fewer parameters, requires
fitting via maximum likelihood estimation (MLE). This approach is available
in <code class="xref py py-class docutils literal notranslate"><span class="pre">BoutsMLE</span></code>.</p>
<p>Set up an instance.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">postdives_mlebouts</span> <span class="o">=</span> <span class="n">skbouts</span><span class="o">.</span><span class="n">BoutsMLE</span><span class="p">(</span><span class="n">postdives_diff</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">postdives_mlebouts</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Class BoutsMLE object
histogram method:    standard
log-frequency histogram:
             x  lnfreq
count    50.00  50.000
mean    284.54  -3.684
std     376.22   2.632
min       0.05  -8.216
25%      42.55  -5.521
50%     122.55  -3.912
75%     328.80  -2.798
max    1449.95   3.258
</pre></div>
</div>
</div>
</div>
<p>Again, assuming a 2-process model, calculate starting values.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">_FIG1X1</span><span class="p">)</span>
<span class="n">init_pars</span> <span class="o">=</span> <span class="n">postdives_mlebouts</span><span class="o">.</span><span class="n">init_pars</span><span class="p">([</span><span class="mi">50</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<img alt="_images/boutsdemo_16_0.png" src="_images/boutsdemo_16_0.png" />
</div>
</div>
<p>Fit the two-process model.  It is important, but optional, to supply
reasonable bounds to help the optimization algorithm.  Otherwise, the
algorithm may fail to converge.  The fitting procedure is done in two
steps: with and without a reparameterized log-likelihood function.
Therefore, there are two sets of bounds required.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">p_bnd</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                 <span class="c1"># bounds for `p`</span>
<span class="n">lda1_bnd</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>              <span class="c1"># bounds for `lambda1`</span>
<span class="n">lda2_bnd</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>             <span class="c1"># bounds for `lambda2`</span>
<span class="n">bnd1</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_bnd</span><span class="p">,</span> <span class="n">lda1_bnd</span><span class="p">,</span> <span class="n">lda2_bnd</span><span class="p">)</span>
<span class="n">p_bnd</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">lda1_bnd</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">lda2_bnd</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-8</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">bnd2</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_bnd</span><span class="p">,</span> <span class="n">lda1_bnd</span><span class="p">,</span> <span class="n">lda2_bnd</span><span class="p">)</span>
<span class="n">fit1</span><span class="p">,</span> <span class="n">fit2</span> <span class="o">=</span> <span class="n">postdives_mlebouts</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">init_pars</span><span class="p">,</span>
                                    <span class="n">fit1_opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
                                                   <span class="n">bounds</span><span class="o">=</span><span class="n">bnd1</span><span class="p">),</span>
                                    <span class="n">fit2_opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
                                                   <span class="n">bounds</span><span class="o">=</span><span class="n">bnd2</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># First fit</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit1</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>      fun: 917.8524699075529
 hess_inv: &lt;3x3 LbfgsInvHessProduct with dtype=float64&gt;
      jac: array([+0., -0., +0.])
  message: &#39;CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH&#39;
     nfev: 40
      nit: 8
     njev: 10
   status: 0
  success: True
        x: array([+0.826, -2.69 , -5.629])
</pre></div>
</div>
</div>
</div>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Second fit</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit2</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>      fun: 917.8524699073647
 hess_inv: &lt;3x3 LbfgsInvHessProduct with dtype=float64&gt;
      jac: array([+0.001, +0.001, +0.003])
  message: &#39;CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH&#39;
     nfev: 16
      nit: 1
     njev: 4
   status: 0
  success: True
        x: array([+0.696, +0.068, +0.004])
</pre></div>
</div>
</div>
</div>
<p>Calculate bout-ending criterion (BEC).</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">80</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bec = </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">postdives_mlebouts</span><span class="o">.</span><span class="n">bec</span><span class="p">(</span><span class="n">fit2</span><span class="p">)))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>bec = 58.55
</pre></div>
</div>
</div>
</div>
<p>Plot the fit.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">_FIG1X1</span><span class="p">)</span>
<span class="n">postdives_mlebouts</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">(</span><span class="n">fit2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<img alt="_images/boutsdemo_21_0.png" src="_images/boutsdemo_21_0.png" />
</div>
</div>
<p>Compare the cumulative frequency distribution between NLS and MLE model
estimates.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">_FIG1X2</span><span class="p">)</span>
<span class="n">postdives_nlsbouts</span><span class="o">.</span><span class="n">plot_ecdf</span><span class="p">(</span><span class="n">coefs2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;NLS&quot;</span><span class="p">)</span>
<span class="n">postdives_mlebouts</span><span class="o">.</span><span class="n">plot_ecdf</span><span class="p">(</span><span class="n">fit2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;MLE&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<img alt="_images/boutsdemo_22_0.png" src="_images/boutsdemo_22_0.png" />
</div>
</div>
<p>Label bouts based on BEC from the last MLE model.  Note that <cite>Timedelta</cite>
type needs to be converted to total seconds to allow comparison with BEC.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">bec</span> <span class="o">=</span> <span class="n">postdives_mlebouts</span><span class="o">.</span><span class="n">bec</span><span class="p">(</span><span class="n">fit2</span><span class="p">)</span>
<span class="n">skbouts</span><span class="o">.</span><span class="n">label_bouts</span><span class="p">(</span><span class="n">postdives</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span> <span class="n">bec</span><span class="p">,</span> <span class="n">as_diff</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>236     1
237     2
238     3
239     4
240     4
       ..
422    51
423    51
424    51
425    52
426    52
Name: postdive_dur, Length: 191, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Feel free to download a copy of this demo
(<a class="reference download internal" download="" href="_downloads/6df43eb0156a4315e24cdd5e2a4c72ba/boutsdemo.py"><code class="xref download docutils literal notranslate"><span class="pre">boutsdemo.py</span></code></a>).</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/skdiveMove_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Bout analysis</a><ul>
<li><a class="reference internal" href="#calculate-postdive-duration">Calculate postdive duration</a></li>
<li><a class="reference internal" href="#non-linear-least-squares-via-broken-stick-model">Non-linear least squares via “broken-stick” model</a><ul>
<li><a class="reference internal" href="#two-process-model">Two-process model</a></li>
<li><a class="reference internal" href="#three-process-model">Three-process model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#maximum-likelihood-estimation">Maximum likelihood estimation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tdrdemo.html"
                        title="previous chapter">Diving behaviour analysis</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="boutsimuldemo.html"
                        title="next chapter">Simulating bouts</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/boutsdemo.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="boutsimuldemo.html" title="Simulating bouts"
             >next</a> |</li>
        <li class="right" >
          <a href="tdrdemo.html" title="Diving behaviour analysis"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">skdiveMove 0.1.9 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Bout analysis</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Sebastian Luque.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
    </div>
<div class="footer">
  scikit-diveMove icon created by B. Agustín Amenábar Larraín
  from Noun Project
</div>

  </body>
</html>